"use strict";(()=>{var e={};e.id=553,e.ids=[553],e.modules={38013:e=>{e.exports=require("mongodb")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},43864:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>v});var a={};r.r(a),r.d(a,{GET:()=>p});var n=r(95419),o=r(69108),i=r(99678),s=r(78070),u=r(81355),c=r(3205),l=r(42010);async function p(e){try{let e=await (0,u.getServerSession)(c.L);if(!e?.user?.email)return s.Z.json({error:"Unauthorized"},{status:401});let t=await (0,l.Qh)(),r=await t.findOne({email:e.user.email});if(!r||"admin"!==r.role)return s.Z.json({error:"Forbidden"},{status:403});let a=await (0,l.Ok)(),n=await (0,l.OE)(),o=await (0,l.gC)(),i=await a.countDocuments(),p=await t.countDocuments(),d=await n.countDocuments(),g=await o.countDocuments(),m=await a.find({}).sort({createdAt:-1}).limit(10).toArray(),w=(await a.aggregate([{$group:{_id:"$category",count:{$sum:1}}},{$sort:{count:-1}},{$limit:10}]).toArray()).map(e=>({category:e._id,count:e.count})),h=(await a.aggregate([{$group:{_id:"$pricing",count:{$sum:1}}},{$sort:{count:-1}}]).toArray()).map(e=>({pricing:e._id,count:e.count})),v=new Date;v.setMonth(v.getMonth()-6);let y=[];for(let e=5;e>=0;e--){let r=new Date;r.setMonth(r.getMonth()-e),r.setDate(1),r.setHours(0,0,0,0);let n=new Date(r);n.setMonth(n.getMonth()+1);let o=r.toLocaleDateString("en-US",{month:"short",year:"numeric"}),i=await a.countDocuments({createdAt:{$gte:r,$lt:n}}),s=await t.countDocuments({createdAt:{$gte:r,$lt:n}});y.push({month:o,tools:i,users:s})}let f=(await a.aggregate([{$group:{_id:"$status",count:{$sum:1}}},{$sort:{count:-1}}]).toArray()).map(e=>({status:e._id,count:e.count})),x=await a.aggregate([{$group:{_id:null,avgRating:{$avg:"$rating"}}}]).toArray(),D=x.length>0?Math.round(10*x[0].avgRating)/10:0,O=await a.countDocuments({featured:!0}),$=await a.countDocuments({apiAvailable:!0}),q={totalTools:i,totalUsers:p,totalReviews:d,totalFavorites:g,recentTools:m,topCategories:w,toolsByPricing:h,monthlyGrowth:y,toolsByStatus:f,averageRating:D,featuredToolsCount:O,apiToolsCount:$,lastUpdated:new Date().toISOString()};return s.Z.json(q)}catch(e){return console.error("Error fetching admin stats:",e),s.Z.json({error:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/stats/route",pathname:"/api/admin/stats",filename:"route",bundlePath:"app/api/admin/stats/route"},resolvedPagePath:"C:\\Users\\Heylel Yaka\\Desktop\\klicktools\\app\\api\\admin\\stats\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:w,headerHooks:h,staticGenerationBailout:v}=d,y="/api/admin/stats/route";function f(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},3205:(e,t,r)=>{r.d(t,{L:()=>c});var a=r(10375),n=r(50694),o=r(86485),i=r(6521),s=r.n(i),u=r(42010);let c={providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({clientId:process.env.GITHUB_ID,clientSecret:process.env.GITHUB_SECRET}),(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=await (0,u.Qh)(),r=await t.findOne({email:e.email.toLowerCase()});if(!r||!r.password||!await s().compare(e.password,r.password))return null;return{id:r._id.toString(),email:r.email,name:r.name||"",role:r.role,image:r.image||""}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t,account:r})=>(t&&(e.role=t.role,e.id=t.id),e),session:async({session:e,token:t})=>(t&&(e.user.role=t.role,e.user.id=t.id),e),async signIn({user:e,account:t,profile:r}){if(t?.provider==="google"||t?.provider==="github")try{let t=await (0,u.Qh)();await t.findOne({email:e.email?.toLowerCase()})||await t.insertOne({email:e.email?.toLowerCase(),name:e.name||"",image:e.image||"",role:"user",createdAt:new Date,updatedAt:new Date})}catch(e){console.error("OAuth signin error:",e)}return!0}},pages:{signIn:"/auth/signin"},secret:process.env.NEXTAUTH_SECRET}},42010:(e,t,r)=>{r.d(t,{gC:()=>l,OE:()=>c,Ok:()=>u,Qh:()=>s});var a=r(38013);let n=function(){if(!process.env.MONGODB_URI)throw Error('Invalid/Missing environment variable: "MONGODB_URI"');let e=process.env.MONGODB_URI;return new a.MongoClient(e,{}).connect()}(),o=null;async function i(){return o||(o=(await n).db("klicktools")),o}async function s(){return(await i()).collection("users")}async function u(){return(await i()).collection("tools")}async function c(){return(await i()).collection("reviews")}async function l(){return(await i()).collection("favorites")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,521,520],()=>r(43864));module.exports=a})();